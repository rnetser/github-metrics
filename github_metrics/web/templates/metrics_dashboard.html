<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GitHub Metrics Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23007bff'/%3E%3Cpath d='M30 35 L50 50 L30 65 M50 50 L70 50' stroke='white' stroke-width='8' stroke-linecap='round' stroke-linejoin='round' fill='none'/%3E%3C/svg%3E" />
    <link rel="stylesheet" href="/static/css/metrics_dashboard.css" />
  </head>
  <body>
    <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation menu">‚ò∞</button>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <div class="app-layout">
      <aside class="sidebar" id="sidebar">
        <button class="sidebar-collapse-toggle" id="sidebar-collapse-toggle" aria-label="Toggle sidebar" title="Toggle sidebar">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <nav class="sidebar-nav">
          <a href="#overview" class="nav-item active" data-page="overview">
            <span class="nav-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
              </svg>
            </span>
            <span class="nav-text">Overview</span>
          </a>
          <a href="#contributors" class="nav-item" data-page="contributors">
            <span class="nav-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
            </span>
            <span class="nav-text">Contributors</span>
          </a>
        </nav>
        <div class="sidebar-footer">
          <button
            id="theme-toggle"
            class="theme-toggle sidebar-theme-toggle"
            title="Toggle between light and dark theme"
            aria-label="Toggle light or dark theme"
          >
            üåô
          </button>
        </div>
      </aside>
      <main class="main-content">
        <!-- Shared control panel - visible on all pages -->
        <div class="container">
          <div class="header">
            <div class="header-title-group">
              <div class="status-inline-wrapper">
                <span class="status-inline" id="connection-status-inline">
                  <span id="statusTextInline">Connecting...</span>
                </span>
                <div class="status-tooltip">
                  <div class="status-tooltip-content">
                    <p><strong>Total Events:</strong> <span id="tooltipTotalEvents">-</span> <span id="tooltipTotalEventsTrend" class="kpi-trend-text">-</span></p>
                    <p><strong>Success Rate:</strong> <span id="tooltipSuccessRate">-</span> <span id="tooltipSuccessRateTrend" class="kpi-trend-text">-</span></p>
                    <p><strong>Failed Events:</strong> <span id="tooltipFailedEvents">-</span> <span id="tooltipFailedEventsTrend" class="kpi-trend-text">-</span></p>
                    <p><strong>Avg Duration:</strong> <span id="tooltipAvgDuration">-</span> <span id="tooltipAvgDurationTrend" class="kpi-trend-text">-</span></p>
                    <p class="status-tooltip-note"><em>Trends compare current period stats with the previous equivalent period</em></p>
                  </div>
                </div>
              </div>
              <h1>GitHub Metrics Dashboard</h1>
            </div>
            <div class="header-actions">
              <a
                href="/docs"
                target="_blank"
                rel="noopener noreferrer"
                class="docs-link"
                aria-label="View API documentation"
                title="View API documentation"
              >
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h6v6h6v10H6z"/>
                  <path d="M8 12h8v2H8zm0 4h8v2H8z"/>
                </svg>
              </a>
              <a
                href="https://github.com/myk-org/github-metrics"
                target="_blank"
                rel="noopener noreferrer"
                class="github-link"
                aria-label="View source code on GitHub"
                title="View source code on GitHub"
              >
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 16 16"
                  fill="currentColor"
                  xmlns="http://www.w3.org/2000/svg"
                  aria-hidden="true"
                >
                  <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
              </a>
            </div>
          </div>

          <!-- Loading Spinner Overlay -->
          <div id="loading-spinner" class="loading-spinner" style="display: none;" role="status" aria-live="polite" aria-busy="true">
            <div class="spinner"></div>
            <p>Loading metrics...</p>
          </div>

          <div class="control-panel" data-section="control-panel">
            <div class="panel-header">
              <h3>Filters & Controls</h3>
              <button class="btn-icon collapse-btn" data-section="control-panel" title="Collapse Panel">‚ñº</button>
            </div>

            <div class="panel-content">
              <div class="filters">
                <div class="filter-group">
                  <label for="time-range-select">Quick Range:</label>
                  <select id="time-range-select">
                    <option value="1h">Last Hour</option>
                    <option value="24h">Last 24 Hours</option>
                    <option value="7d" selected>Last 7 Days</option>
                    <option value="30d">Last 30 Days</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label for="startTime">Start Time:</label>
                  <input type="datetime-local" id="startTime" />
                </div>
                <div class="filter-group">
                  <label for="endTime">End Time:</label>
                  <input type="datetime-local" id="endTime" />
                </div>
                <div class="filter-group">
                  <label for="repositoryFilter">Repository:</label>
                  <div class="combo-box-wrapper" id="repository-filter-group">
                    <input type="text" id="repositoryFilter" placeholder="Type to search or select..." />
                  </div>
                </div>
                <div class="filter-group">
                  <label for="userFilter">User:</label>
                  <div class="combo-box-wrapper" id="user-filter-group">
                    <input type="text" id="userFilter" placeholder="Type to search or select..." />
                  </div>
                </div>
                <div class="filter-group filter-group-button">
                  <button id="refresh-button" class="btn btn-primary" title="Reload Metrics">Refresh</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Page-specific content -->
        <div class="page" id="page-overview">
          <div class="container">

      <div class="dashboard-grid">
        <div class="chart-container" data-section="top-repositories">
          <div class="chart-header">
            <h2>Top Repositories</h2>
            <div class="chart-header-actions">
              <button class="btn-icon download-btn" data-section="topRepositories" data-format="csv" title="Download as CSV" aria-label="Download top repositories data as CSV">‚¨áÔ∏è CSV</button>
              <button class="btn-icon download-btn" data-section="topRepositories" data-format="json" title="Download as JSON" aria-label="Download top repositories data as JSON">‚¨áÔ∏è JSON</button>
              <button class="btn-icon collapse-btn" data-section="top-repositories" title="Collapse">‚ñº</button>
            </div>
          </div>
          <div class="chart-content">
            <div class="table-wrapper">
              <table id="topRepositoriesTable">
                <thead>
                  <tr>
                    <th scope="col" class="sortable" data-column="repository">Repository</th>
                    <th scope="col" class="sortable" data-column="total_events">Events</th>
                    <th scope="col" class="sortable" data-column="percentage">%</th>
                  </tr>
                </thead>
                <tbody id="repository-table-body">
                  <tr class="loading-row">
                    <td colspan="3">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="chart-container" data-section="recent-events">
          <div class="chart-header">
            <h2>Recent Events</h2>
            <div class="chart-header-actions">
              <button class="btn-icon download-btn" data-section="recentEvents" data-format="csv" title="Download as CSV" aria-label="Download recent events data as CSV">‚¨áÔ∏è CSV</button>
              <button class="btn-icon download-btn" data-section="recentEvents" data-format="json" title="Download as JSON" aria-label="Download recent events data as JSON">‚¨áÔ∏è JSON</button>
              <button class="btn-icon collapse-btn" data-section="recent-events" title="Collapse">‚ñº</button>
            </div>
          </div>
          <div class="chart-content">
            <div class="table-wrapper">
              <table id="recentEventsTable">
                <thead>
                  <tr>
                    <th scope="col" class="sortable" data-column="created_at">Time</th>
                    <th scope="col" class="sortable" data-column="repository">Repository</th>
                    <th scope="col" class="sortable" data-column="event_type">Event</th>
                    <th scope="col" class="sortable" data-column="status">Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="loading-row">
                    <td colspan="4">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="chart-container full-width" data-section="pr-contributors">
          <div class="chart-header">
            <h2>PR Contributors</h2>
            <div class="chart-header-actions">
              <button class="btn-icon collapse-btn" data-section="pr-contributors" title="Collapse">‚ñº</button>
            </div>
          </div>
          <div class="chart-content">
            <div class="contributors-grid">
            <!-- PR Creators -->
            <div class="contributor-section" data-section="pr-creators">
              <div class="contributor-header">
                <h3>PR Creators</h3>
                <div class="contributor-actions">
                  <button class="btn-icon download-btn" data-section="prCreators" data-format="csv" title="Download as CSV" aria-label="Download PR creators data as CSV">‚¨áÔ∏è CSV</button>
                  <button class="btn-icon download-btn" data-section="prCreators" data-format="json" title="Download as JSON" aria-label="Download PR creators data as JSON">‚¨áÔ∏è JSON</button>
                </div>
              </div>
              <div class="table-wrapper">
                <table id="prCreatorsTable">
                  <thead>
                    <tr>
                      <th scope="col" class="sortable" data-column="user">User</th>
                      <th scope="col" class="sortable" data-column="total_prs">Total PRs</th>
                      <th scope="col" class="sortable" data-column="merged_prs">Merged</th>
                      <th scope="col" class="sortable" data-column="closed_prs">Closed</th>
                      <th scope="col" class="sortable" data-column="avg_commits_per_pr">Avg Commits</th>
                    </tr>
                  </thead>
                  <tbody id="pr-creators-table-body">
                    <tr class="loading-row">
                      <td colspan="5">Loading...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- PR Reviewers -->
            <div class="contributor-section" data-section="pr-reviewers">
              <div class="contributor-header">
                <h3>PR Reviewers</h3>
                <div class="contributor-actions">
                  <button class="btn-icon download-btn" data-section="prReviewers" data-format="csv" title="Download as CSV" aria-label="Download PR reviewers data as CSV">‚¨áÔ∏è CSV</button>
                  <button class="btn-icon download-btn" data-section="prReviewers" data-format="json" title="Download as JSON" aria-label="Download PR reviewers data as JSON">‚¨áÔ∏è JSON</button>
                </div>
              </div>
              <div class="table-wrapper">
                <table id="prReviewersTable">
                  <thead>
                    <tr>
                      <th scope="col" class="sortable" data-column="user">User</th>
                      <th scope="col" class="sortable" data-column="total_reviews">Total Reviews</th>
                      <th scope="col" class="sortable" data-column="prs_reviewed">PRs Reviewed</th>
                      <th scope="col" class="sortable" data-column="avg_reviews_per_pr">Avg/PR</th>
                    </tr>
                  </thead>
                  <tbody id="pr-reviewers-table-body">
                    <tr class="loading-row">
                      <td colspan="4">Loading...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- PR Approvers -->
            <div class="contributor-section" data-section="pr-approvers">
              <div class="contributor-header">
                <h3>PR Approvers</h3>
                <div class="contributor-actions">
                  <button class="btn-icon download-btn" data-section="prApprovers" data-format="csv" title="Download as CSV" aria-label="Download PR approvers data as CSV">‚¨áÔ∏è CSV</button>
                  <button class="btn-icon download-btn" data-section="prApprovers" data-format="json" title="Download as JSON" aria-label="Download PR approvers data as JSON">‚¨áÔ∏è JSON</button>
                </div>
              </div>
              <div class="table-wrapper">
                <table id="prApproversTable">
                  <thead>
                    <tr>
                      <th scope="col" class="sortable" data-column="user">User</th>
                      <th scope="col" class="sortable" data-column="total_approvals">Total Approvals</th>
                      <th scope="col" class="sortable" data-column="prs_approved">PRs Approved</th>
                    </tr>
                  </thead>
                  <tbody id="pr-approvers-table-body">
                    <tr class="loading-row">
                      <td colspan="3">Loading...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          </div>
        </div>

        <div class="chart-container full-width" data-section="user-prs">
          <div class="chart-header">
            <h2>Pull Requests</h2>
            <div class="chart-header-actions">
              <button class="btn-icon download-btn" data-section="userPrs" data-format="csv" title="Download as CSV" aria-label="Download pull requests data as CSV">‚¨áÔ∏è CSV</button>
              <button class="btn-icon download-btn" data-section="userPrs" data-format="json" title="Download as JSON" aria-label="Download pull requests data as JSON">‚¨áÔ∏è JSON</button>
              <button class="btn-icon collapse-btn" data-section="user-prs" title="Collapse">‚ñº</button>
            </div>
          </div>
          <div class="chart-content">
            <div class="table-wrapper">
              <table id="userPrsTable">
                <thead>
                  <tr>
                    <th scope="col" class="sortable" data-column="number">PR</th>
                    <th scope="col" class="sortable" data-column="title">Title</th>
                    <th scope="col" class="sortable" data-column="owner">Owner</th>
                    <th scope="col" class="sortable" data-column="repository">Repository</th>
                    <th scope="col" class="sortable" data-column="state">State</th>
                    <th scope="col" class="sortable" data-column="created_at">Created</th>
                    <th scope="col" class="sortable" data-column="updated_at">Updated</th>
                    <th scope="col" class="sortable" data-column="commits_count">Commits</th>
                  </tr>
                </thead>
                <tbody id="user-prs-table-body">
                  <tr class="loading-row">
                    <td colspan="8">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
        </div>

        <div class="page" id="page-contributors">
          <div class="container">
            <div class="header">
              <div>
                <h1>Contributors Analytics</h1>
                <p>Review turnaround times and response metrics</p>
              </div>
            </div>

            <!-- Loading State -->
            <div id="turnaround-loading" class="loading-state" style="display: none;">
              <div class="spinner" aria-hidden="true"></div>
              <p>Loading turnaround metrics...</p>
            </div>

            <!-- Error State -->
            <div id="turnaround-error" class="error-state" style="display: none;">
              <p class="error-message"></p>
            </div>

            <!-- Metrics Content -->
            <div id="turnaround-content" style="display: none;">
              <!-- Summary KPI Cards -->
              <div class="chart-container full-width" data-section="turnaround-kpi-cards">
                <div class="panel-header">
                  <h3>Summary Metrics</h3>
                  <button class="btn-icon collapse-btn" data-section="turnaround-kpi-cards" title="Collapse Panel">‚ñº</button>
                </div>
                <div class="panel-content">
                  <div class="kpi-cards-grid">
                    <div class="kpi-card">
                      <div class="kpi-label">Avg First Review</div>
                      <div class="kpi-value" id="kpi-first-review">-</div>
                      <div class="kpi-unit"></div>
                    </div>
                    <div class="kpi-card">
                      <div class="kpi-label">Avg Approval</div>
                      <div class="kpi-value" id="kpi-approval">-</div>
                      <div class="kpi-unit"></div>
                    </div>
                    <div class="kpi-card">
                      <div class="kpi-label">Avg PR Lifecycle</div>
                      <div class="kpi-value" id="kpi-lifecycle">-</div>
                      <div class="kpi-unit"></div>
                    </div>
                    <div class="kpi-card">
                      <div class="kpi-label">PRs Analyzed</div>
                      <div class="kpi-value" id="kpi-total-prs">-</div>
                      <div class="kpi-unit">pull requests</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- By Repository Section -->
              <div class="dashboard-grid">
                <div class="chart-container full-width" data-section="turnaround-by-repo">
                  <div class="chart-header">
                    <h2>Turnaround by Repository</h2>
                    <div class="chart-header-actions">
                      <button class="btn-icon download-btn" data-section="turnaroundByRepo" data-format="csv" title="Download as CSV" aria-label="Download turnaround by repository data as CSV">‚¨áÔ∏è CSV</button>
                      <button class="btn-icon download-btn" data-section="turnaroundByRepo" data-format="json" title="Download as JSON" aria-label="Download turnaround by repository data as JSON">‚¨áÔ∏è JSON</button>
                      <button class="btn-icon collapse-btn" data-section="turnaround-by-repo" title="Collapse">‚ñº</button>
                    </div>
                  </div>
                  <div class="chart-content">
                    <div class="table-wrapper">
                      <table id="turnaroundByRepoTable">
                        <caption class="sr-only">Review turnaround times by repository</caption>
                        <thead>
                          <tr>
                            <th scope="col" class="sortable" data-column="repository">Repository</th>
                            <th scope="col" class="sortable" data-column="avg_time_to_first_review_hours">First Review (hrs)</th>
                            <th scope="col" class="sortable" data-column="avg_time_to_approval_hours">Approval (hrs)</th>
                            <th scope="col" class="sortable" data-column="avg_pr_lifecycle_hours">Lifecycle (hrs)</th>
                            <th scope="col" class="sortable" data-column="total_prs">PRs</th>
                          </tr>
                        </thead>
                        <tbody id="turnaround-by-repo-body">
                          <tr class="loading-row">
                            <td colspan="5">Loading...</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <!-- By Reviewer Section -->
                <div class="chart-container full-width" data-section="turnaround-by-reviewer">
                  <div class="chart-header">
                    <h2>Response Time by Reviewer</h2>
                    <div class="chart-header-actions">
                      <button class="btn-icon download-btn" data-section="turnaroundByReviewer" data-format="csv" title="Download as CSV" aria-label="Download response time by reviewer data as CSV">‚¨áÔ∏è CSV</button>
                      <button class="btn-icon download-btn" data-section="turnaroundByReviewer" data-format="json" title="Download as JSON" aria-label="Download response time by reviewer data as JSON">‚¨áÔ∏è JSON</button>
                      <button class="btn-icon collapse-btn" data-section="turnaround-by-reviewer" title="Collapse">‚ñº</button>
                    </div>
                  </div>
                  <div class="chart-content">
                    <div class="table-wrapper">
                      <table id="turnaroundByReviewerTable">
                        <caption class="sr-only">Response times by reviewer</caption>
                        <thead>
                          <tr>
                            <th scope="col" class="sortable" data-column="reviewer">Reviewer</th>
                            <th scope="col" class="sortable" data-column="avg_response_time_hours">Avg Response (hrs)</th>
                            <th scope="col" class="sortable" data-column="total_reviews">Total Reviews</th>
                            <th scope="col" class="sortable" data-column="repositories_reviewed">Repositories</th>
                          </tr>
                        </thead>
                        <tbody id="turnaround-by-reviewer-body">
                          <tr class="loading-row">
                            <td colspan="4">Loading...</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Load JavaScript modules in correct order -->
    <script type="module" src="/static/js/metrics/utils.js"></script>
    <script type="module" src="/static/js/metrics/api-client.js"></script>
    <script type="module" src="/static/js/metrics/combo-box.js"></script>
    <script type="module" src="/static/js/metrics/pr-story.js"></script>
    <script type="module" src="/static/js/metrics/turnaround.js"></script>
    <script type="module" src="/static/js/metrics/navigation.js"></script>
    <script type="module" src="/static/js/metrics/dashboard.js"></script>
  </body>
</html>
